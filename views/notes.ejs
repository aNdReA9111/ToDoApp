<%- include('partials/header'); -%>

<style>
  /* Style for controlling image width */
  .card-body img {
    max-width: 100%; /* Ensure images don't exceed the width of their container */
    height: auto; /* Maintain aspect ratio */
  }
</style>

<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card">
        <div class="card-header">
          <%= post.lastEditDate.toDateString() %>                
        </div>
        <div class="card-body">

          <form action="/notes/<%= post._id %>/<% if (post.completed) { %>true<% } else { %>false<% } %>" method="post" class="form-check" onsubmit="event.preventDefault();">
            <label class="form-check-label" for="main-task">
              <%= post.title %>
            </label>

            <input  class="form-check-input" type="checkbox" 
                    name="main-task" 
                    id="main-task" 
                    onchange="this.form.submit()" 
                    <% if (post.completed) { %> checked <% } %> 
            >
          </form>

          <!-- Render content without escaping -->
          <p class="card-text"><%- post.content %></p> <!-- Correct EJS syntax -->
          
          <% for(let i = 0; i < post.subtasks.length; i++) { %>
            <span>
              <form action="/notes/<%= post._id %>/<%= i %>/<% if (post.subtasks[i].completed) { %>true<% } else { %>false<% } %> " method="post" class="form-check" onsubmit="event.preventDefault();">
                
                <label class="form-check-label" for="task-<%= i %>">
                  <%= post.subtasks[i].title %>
                </label>

                <input class="form-check-input" type="checkbox" 
                  name="task-<%= i %>" 
                  id="task-<%= i %>" 
                  onchange="this.form.submit()" 
                  <% if (post.subtasks[i].completed) { %> checked <% } %> 
                />
              </form>
              <form action="/notes/delete/<%= post.author %>/<%= post._id %>/<%= i %>" method="post">
                <button type="submit">x</button>
              </form>
            </span>
          <% } %>
          
          <p class="card-text">
            <small class="text-muted">Written by <%= post.author %> in <%= post.place %></small>
          </p>
          <p class="card-text">
            <small class="text-muted">Tags: <%= post.tags.join(', ') %></small>
          </p>
          <form action="/notes/delete/<%= post.author %>/<%= post._id %>" method="POST">
            <button type="submit" class="btn btn-danger">Delete Post</button> 
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<%- include('partials/footer'); -%>
